"use strict";(self.webpackChunkchatgpt_api=self.webpackChunkchatgpt_api||[]).push([[274,929,811],{21782:(b,f,n)=>{n.d(f,{Al:()=>c,dy:()=>p});var o=n(15861),h=n(74010);class m{constructor(e){Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new h.Z(this.value)]}}class p{constructor(e){Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}mergePartialAndUserVariables(e){var t=this;return(0,o.Z)(function*(){const s=t.partialVariables??{},a={};for(const[u,d]of Object.entries(s))a[u]="string"==typeof d?d:yield d();return{...a,...e}})()}static deserialize(e){return(0,o.Z)(function*(){switch(e._type){case"prompt":{const{PromptTemplate:t}=yield Promise.resolve().then(n.bind(n,194));return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=yield Promise.resolve().then(n.bind(n,194));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=yield n.e(811).then(n.bind(n,80811));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}})()}}class c extends p{formatPromptValue(e){var t=this;return(0,o.Z)(function*(){const s=yield t.format(e);return new m(s)})()}}},80811:(b,f,n)=>{n.r(f),n.d(f,{FewShotPromptTemplate:()=>c});var o=n(15861),h=n(21782),m=n(33087),p=n(194);class c extends h.Al{constructor(r){if(super(r),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,r),void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,m.af)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}getExamples(r){var e=this;return(0,o.Z)(function*(){if(void 0!==e.examples)return e.examples;if(void 0!==e.exampleSelector)return e.exampleSelector.selectExamples(r);throw new Error("One of 'examples' and 'example_selector' should be provided")})()}partial(r){var e=this;return(0,o.Z)(function*(){const t={...e};return t.inputVariables=e.inputVariables.filter(s=>!(s in r)),t.partialVariables={...e.partialVariables??{},...r},new c(t)})()}format(r){var e=this;return(0,o.Z)(function*(){const t=yield e.mergePartialAndUserVariables(r),s=yield e.getExamples(t),a=yield Promise.all(s.map(u=>e.examplePrompt.format(u))),i=[e.prefix,...a,e.suffix].join(e.exampleSeparator);return(0,m.SM)(i,e.templateFormat,t)})()}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static deserialize(r){return(0,o.Z)(function*(){const{example_prompt:e}=r;if(!e)throw new Error("Missing example prompt");const t=yield p.PromptTemplate.deserialize(e);let s;if(!Array.isArray(r.examples))throw new Error("Invalid examples format. Only list or string are supported.");return s=r.examples,new c({inputVariables:r.input_variables,examplePrompt:t,examples:s,exampleSeparator:r.example_separator,prefix:r.prefix,suffix:r.suffix,templateFormat:r.template_format})})()}}},194:(b,f,n)=>{n.r(f),n.d(f,{PromptTemplate:()=>p});var o=n(15861),h=n(21782),m=n(33087);class p extends h.Al{constructor(l){if(super(l),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,l),this.validateTemplate){let r=this.inputVariables;this.partialVariables&&(r=r.concat(Object.keys(this.partialVariables))),(0,m.af)(this.template,this.templateFormat,r)}}_getPromptType(){return"prompt"}format(l){var r=this;return(0,o.Z)(function*(){const e=yield r.mergePartialAndUserVariables(l);return(0,m.SM)(r.template,r.templateFormat,e)})()}static fromExamples(l,r,e,t="\n\n",s=""){const a=[s,...l,r].join(t);return new p({inputVariables:e,template:a})}static fromTemplate(l,{templateFormat:r="f-string",...e}={}){const t=new Set;return(0,m.$M)(l,r).forEach(s=>{"variable"===s.type&&t.add(s.name)}),new p({inputVariables:[...t],templateFormat:r,template:l,...e})}partial(l){var r=this;return(0,o.Z)(function*(){const e={...r};return e.inputVariables=r.inputVariables.filter(t=>!(t in l)),e.partialVariables={...r.partialVariables??{},...l},new p(e)})()}serialize(){if(void 0!==this.outputParser)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static deserialize(l){return(0,o.Z)(function*(){if(!l.template)throw new Error("Prompt template must have a template");return new p({inputVariables:l.input_variables,template:l.template,templateFormat:l.template_format})})()}}},33087:(b,f,n)=>{n.d(f,{$M:()=>l,SM:()=>c,af:()=>r});const o=e=>{const t=e.split(""),s=[],a=(u,d)=>{for(let _=d;_<t.length;_+=1)if(u.includes(t[_]))return _;return-1};let i=0;for(;i<t.length;)if("{"===t[i]&&i+1<t.length&&"{"===t[i+1])s.push({type:"literal",text:"{"}),i+=2;else if("}"===t[i]&&i+1<t.length&&"}"===t[i+1])s.push({type:"literal",text:"}"}),i+=2;else if("{"===t[i]){const u=a("}",i);if(u<0)throw new Error("Unclosed '{' in template.");s.push({type:"variable",name:t.slice(i+1,u).join("")}),i=u+1}else{if("}"===t[i])throw new Error("Single '}' in template.");{const u=a("{}",i),d=(u<0?t.slice(i):t.slice(i,u)).join("");s.push({type:"literal",text:d}),i=u<0?t.length:u}}return s},m={"f-string":(e,t)=>o(e).reduce((s,a)=>{if("variable"===a.type){if(a.name in t)return s+t[a.name];throw new Error(`Missing value for input ${a.name}`)}return s+a.text},""),jinja2:(e,t)=>""},p={"f-string":o,jinja2:e=>[]},c=(e,t,s)=>m[t](e,s),l=(e,t)=>p[t](e),r=(e,t,s)=>{if(!(t in m)){const a=Object.keys(m);throw new Error(`Invalid template format. Got \`${t}\`;\n                         should be one of ${a}`)}try{const a=s.reduce((i,u)=>(i[u]="foo",i),{});c(e,t,a)}catch{throw new Error("Invalid prompt schema.")}}},74010:(b,f,n)=>{n.d(f,{Ck:()=>m,J:()=>c,K3:()=>s,MJ:()=>l,Z:()=>h,w:()=>p});class o{constructor(i){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=i}}class h extends o{_getType(){return"human"}}class m extends o{_getType(){return"ai"}}class p extends o{_getType(){return"system"}}class c extends o{constructor(i,u){super(i),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=u}_getType(){return"generic"}}class l{}class t extends Error{constructor(i){super(i)}}class s{}},15861:(b,f,n)=>{function o(m,p,c,l,r,e,t){try{var s=m[e](t),a=s.value}catch(i){return void c(i)}s.done?p(a):Promise.resolve(a).then(l,r)}function h(m){return function(){var p=this,c=arguments;return new Promise(function(l,r){var e=m.apply(p,c);function t(a){o(e,l,r,t,s,"next",a)}function s(a){o(e,l,r,t,s,"throw",a)}t(void 0)})}}n.d(f,{Z:()=>h})}}]);