"use strict";(self.webpackChunkchatgpt_api=self.webpackChunkchatgpt_api||[]).push([[202,889,811,819],{70889:(N,x,s)=>{s.r(x),s.d(x,{MapReduceDocumentsChain:()=>A,RefineDocumentsChain:()=>o,StuffDocumentsChain:()=>f});var u=s(15861),P=s(1562),v=s(40443),I=s(194);class f extends P.l{get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys]}constructor(t){super(),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=t.llmChain,this.documentVariableName=t.documentVariableName??this.documentVariableName,this.inputKey=t.inputKey??this.inputKey,this.outputKey=t.outputKey??this.outputKey}_call(t){var r=this;return(0,u.Z)(function*(){if(!(r.inputKey in t))throw new Error(`Document key ${r.inputKey} not found.`);const{[r.inputKey]:c,...y}=t,w=c.map(({pageContent:h})=>h).join("\n\n");return yield r.llmChain.call({...y,[r.documentVariableName]:w})})()}_chainType(){return"stuff_documents_chain"}static deserialize(t){return(0,u.Z)(function*(){if(!t.llm_chain)throw new Error("Missing llm_chain");return new f({llmChain:yield v.LLMChain.deserialize(t.llm_chain)})})()}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}class A extends P.l{get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}constructor(t){super(),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=t.llmChain,this.combineDocumentChain=t.combineDocumentChain,this.documentVariableName=t.documentVariableName??this.documentVariableName,this.ensureMapStep=t.ensureMapStep??this.ensureMapStep,this.inputKey=t.inputKey??this.inputKey,this.outputKey=t.outputKey??this.outputKey,this.maxTokens=t.maxTokens??this.maxTokens,this.maxIterations=t.maxIterations??this.maxIterations}_call(t){var r=this;return(0,u.Z)(function*(){if(!(r.inputKey in t))throw new Error(`Document key ${r.inputKey} not found.`);const{[r.inputKey]:c,...y}=t;let d=c;for(let h=0;h<r.maxIterations;h+=1){const g=d.map(T=>({[r.documentVariableName]:T.pageContent,...y})),D=g.map(function(){var T=(0,u.Z)(function*(L){const R=yield r.llmChain.prompt.format(L);return r.llmChain.llm.getNumTokens(R)});return function(L){return T.apply(this,arguments)}}()),C=yield Promise.all(D).then(T=>T.reduce((L,R)=>L+R,0));if((0!==h||!r.ensureMapStep)&&C<r.maxTokens)break;const S=yield r.llmChain.apply(g),{outputKey:V}=r.llmChain;d=S.map(T=>({pageContent:T[V]}))}const w={input_documents:d,...y};return yield r.combineDocumentChain.call(w)})()}_chainType(){return"map_reduce_documents_chain"}static deserialize(t){return(0,u.Z)(function*(){if(!t.llm_chain)throw new Error("Missing llm_chain");if(!t.combine_document_chain)throw new Error("Missing combine_document_chain");return new A({llmChain:yield v.LLMChain.deserialize(t.llm_chain),combineDocumentChain:yield P.l.deserialize(t.combine_document_chain)})})()}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}class o extends P.l{get defaultDocumentPrompt(){return new I.PromptTemplate({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[this.inputKey,...this.refineLLMChain.inputKeys]}constructor(t){super(),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=t.llmChain,this.refineLLMChain=t.refineLLMChain,this.documentVariableName=t.documentVariableName??this.documentVariableName,this.inputKey=t.inputKey??this.inputKey,this.documentPrompt=t.documentPrompt??this.documentPrompt,this.initialResponseName=t.initialResponseName??this.initialResponseName}_constructInitialInputs(t,r){var c=this;return(0,u.Z)(function*(){const y={page_content:t.pageContent,...t.metadata},d={};return c.documentPrompt.inputVariables.forEach(h=>{d[h]=y[h]}),{[c.documentVariableName]:yield c.documentPrompt.format({...d}),...r}})()}_constructRefineInputs(t,r){var c=this;return(0,u.Z)(function*(){const y={page_content:t.pageContent,...t.metadata},d={};c.documentPrompt.inputVariables.forEach(h=>{d[h]=y[h]});const w={[c.documentVariableName]:yield c.documentPrompt.format({...d})};return{[c.initialResponseName]:r,...w}})()}_call(t){var r=this;return(0,u.Z)(function*(){if(!(r.inputKey in t))throw new Error(`Document key ${r.inputKey} not found.`);const{[r.inputKey]:c,...y}=t,d=c,w=yield r._constructInitialInputs(d[0],y);let _=yield r.llmChain.predict({...w});const h=[_];for(let g=1;g<d.length;g+=1){const C={...yield r._constructRefineInputs(d[g],_),...y};_=yield r.refineLLMChain.predict({...C}),h.push(_)}return{[r.outputKey]:_}})()}_chainType(){return"refine_documents_chain"}static deserialize(t){return(0,u.Z)(function*(){const r=t.llm_chain;if(!r)throw new Error("Missing llm_chain");const c=t.refine_llm_chain;if(!c)throw new Error("Missing refine_llm_chain");return new o({llmChain:yield v.LLMChain.deserialize(r),refineLLMChain:yield v.LLMChain.deserialize(c)})})()}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}},59202:(N,x,s)=>{s.r(x),s.d(x,{VectorDBQAChain:()=>j});var u=s(15861),P=s(1562),v=s(40443),I=s(70889),f=s(194),A=s(21782),o=s(74010);class l{serialize(){return{_type:this.constructor.name,...JSON.parse(JSON.stringify(this))}}}class t extends o.MJ{constructor(e){super(),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e}toString(){return JSON.stringify(this.messages)}toChatMessages(){return this.messages}}class c extends l{constructor(e){super(),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e}get inputVariables(){return this.prompt.inputVariables}formatMessages(e){var n=this;return(0,u.Z)(function*(){return[yield n.format(e)]})()}}class y extends A.dy{constructor(e){super(e)}format(e){var n=this;return(0,u.Z)(function*(){return(yield n.formatPromptValue(e)).toString()})()}formatPromptValue(e){var n=this;return(0,u.Z)(function*(){const a=yield n.formatMessages(e);return new t(a)})()}}class g extends y{constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){const n=new Set;for(const p of this.promptMessages)for(const M of p.inputVariables)n.add(M);const a=new Set(this.partialVariables?this.inputVariables.concat(Object.keys(this.partialVariables)):this.inputVariables),m=new Set([...a].filter(p=>!n.has(p)));if(m.size>0)throw new Error(`Input variables \`${[...m]}\` are not used in any of the prompt messages.`);const b=new Set([...n].filter(p=>!a.has(p)));if(b.size>0)throw new Error(`Input variables \`${[...b]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}formatMessages(e){var n=this;return(0,u.Z)(function*(){const a=yield n.mergePartialAndUserVariables(e);let m=[];for(const b of n.promptMessages){const p={};for(const O of b.inputVariables){if(!(O in a))throw new Error(`Missing value for input variable \`${O}\``);p[O]=a[O]}const M=yield b.formatMessages(p);m=m.concat(M)}return m})()}serialize(){if(void 0!==this.outputParser)throw new Error("ChatPromptTemplate cannot be serialized if outputParser is set");return{input_variables:this.inputVariables,prompt_messages:this.promptMessages.map(e=>e.serialize())}}partial(e){var n=this;return(0,u.Z)(function*(){const a={...n};return a.inputVariables=n.inputVariables.filter(m=>!(m in e)),a.partialVariables={...n.partialVariables??{},...e},new g(a)})()}static fromPromptMessages(e){const n=new Set;for(const a of e)for(const m of a.inputVariables)n.add(m);return new g({inputVariables:[...n],promptMessages:e})}}class D{}class C extends D{constructor(e,n=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=n}getPrompt(e){for(const[n,a]of this.conditionals)if(n(e))return a;return this.defaultPrompt}}const R=new C(new f.PromptTemplate({template:"Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.\n\n{context}\n\nQuestion: {question}\nHelpful Answer:",inputVariables:["context","question"]}),[[function E(i){return"base_chat_model"===i._modelType()},g.fromPromptMessages([class h extends c{format(e){var n=this;return(0,u.Z)(function*(){return new o.w(yield n.prompt.format(e))})()}constructor(e){super(e)}static fromTemplate(e){return new this(f.PromptTemplate.fromTemplate(e))}}.fromTemplate("Use the following pieces of context to answer the users question. \nIf you don't know the answer, just say that you don't know, don't try to make up an answer.\n----------------\n{context}"),class w extends c{format(e){var n=this;return(0,u.Z)(function*(){return new o.Z(yield n.prompt.format(e))})()}constructor(e){super(e)}static fromTemplate(e){return new this(f.PromptTemplate.fromTemplate(e))}}.fromTemplate("{question}")])]]);s(80811),s(33087);class j extends P.l{get inputKeys(){return[this.inputKey]}constructor(e){super(),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"result"}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.vectorstore=e.vectorstore,this.combineDocumentsChain=e.combineDocumentsChain,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.k=e.k??this.k,this.returnSourceDocuments=e.returnSourceDocuments??this.returnSourceDocuments}_call(e){var n=this;return(0,u.Z)(function*(){if(!(n.inputKey in e))throw new Error(`Question key ${n.inputKey} not found.`);const a=e[n.inputKey],m=yield n.vectorstore.similaritySearch(a,n.k),b={question:a,input_documents:m},p=yield n.combineDocumentsChain.call(b);return n.returnSourceDocuments?{...p,sourceDocuments:m}:p})()}_chainType(){return"vector_db_qa"}static deserialize(e,n){return(0,u.Z)(function*(){if(!("vectorstore"in n))throw new Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");const{vectorstore:a}=n;if(!e.combine_documents_chain)throw new Error("VectorDBQAChain must have combine_documents_chain in serialized data");return new j({combineDocumentsChain:yield P.l.deserialize(e.combine_documents_chain),k:e.k,vectorstore:a})})()}serialize(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),k:this.k}}static fromLLM(e,n,a){const m=((i,e={})=>{const{prompt:n=R.getPrompt(i)}=e,a=new v.LLMChain({prompt:n,llm:i});return new I.StuffDocumentsChain({llmChain:a})})(e);return new this({vectorstore:n,combineDocumentsChain:m,...a})}}},80811:(N,x,s)=>{s.r(x),s.d(x,{FewShotPromptTemplate:()=>f});var u=s(15861),P=s(21782),v=s(33087),I=s(194);class f extends P.Al{constructor(o){if(super(o),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,o),void 0!==this.examples&&void 0!==this.exampleSelector)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let l=this.inputVariables;this.partialVariables&&(l=l.concat(Object.keys(this.partialVariables))),(0,v.af)(this.prefix+this.suffix,this.templateFormat,l)}}_getPromptType(){return"few_shot"}getExamples(o){var l=this;return(0,u.Z)(function*(){if(void 0!==l.examples)return l.examples;if(void 0!==l.exampleSelector)return l.exampleSelector.selectExamples(o);throw new Error("One of 'examples' and 'example_selector' should be provided")})()}partial(o){var l=this;return(0,u.Z)(function*(){const t={...l};return t.inputVariables=l.inputVariables.filter(r=>!(r in o)),t.partialVariables={...l.partialVariables??{},...o},new f(t)})()}format(o){var l=this;return(0,u.Z)(function*(){const t=yield l.mergePartialAndUserVariables(o),r=yield l.getExamples(t),c=yield Promise.all(r.map(d=>l.examplePrompt.format(d))),y=[l.prefix,...c,l.suffix].join(l.exampleSeparator);return(0,v.SM)(y,l.templateFormat,t)})()}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static deserialize(o){return(0,u.Z)(function*(){const{example_prompt:l}=o;if(!l)throw new Error("Missing example prompt");const t=yield I.PromptTemplate.deserialize(l);let r;if(!Array.isArray(o.examples))throw new Error("Invalid examples format. Only list or string are supported.");return r=o.examples,new f({inputVariables:o.input_variables,examplePrompt:t,examples:r,exampleSeparator:o.example_separator,prefix:o.prefix,suffix:o.suffix,templateFormat:o.template_format})})()}}}}]);