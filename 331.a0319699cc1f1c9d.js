"use strict";(self.webpackChunkchatgpt_api=self.webpackChunkchatgpt_api||[]).push([[331],{51331:(z,S,d)=>{d.r(S),d.d(S,{ChatOpenAI:()=>E});var c=d(15861),O=d(10157),M=d(70052),f=d(74010),k=d(88121),x=d(28256);class R extends k.q{constructor(a){super(a)}generate(a,i){var s=this;return(0,c.Z)(function*(){const u=[],l=[],j=a.map(m=>(0,x.zs)(m));yield s.callbackManager.handleLLMStart({name:s._llmType()},j,s.verbose);try{for(const m of a){const N=yield s._generate(m,i);N.llmOutput&&l.push(N.llmOutput),u.push(N.generations)}}catch(m){throw yield s.callbackManager.handleLLMError(m,s.verbose),m}const A={generations:u,llmOutput:l.length?s._combineLLMOutput?.(...l):void 0};return yield s.callbackManager.handleLLMEnd(A,s.verbose),A})()}_modelType(){return"base_chat_model"}generatePrompt(a,i){var s=this;return(0,c.Z)(function*(){const u=a.map(l=>l.toChatMessages());return s.generate(u,i)})()}call(a,i){var s=this;return(0,c.Z)(function*(){return(yield s.generate([a],i)).generations[0][0].message})()}callPrompt(a,i){var s=this;return(0,c.Z)(function*(){const u=a.toChatMessages();return s.call(u,i)})()}}var v=d(10394);function Z(y){switch(y){case"system":return"system";case"ai":return"assistant";case"human":return"user";default:throw new Error(`Unknown message type: ${y}`)}}function b(y,a){switch(y){case"user":return new f.Z(a);case"assistant":return new f.Ck(a);case"system":return new f.w(a);default:return new f.J(a,y??"unknown")}}class E extends R{constructor(a,i){super(a??{}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const s=a?.openAIApiKey??(typeof process<"u"?process.env.OPENAI_API_KEY:void 0);if(!s)throw new Error("OpenAI API key not found");if(this.modelName=a?.modelName??this.modelName,this.modelKwargs=a?.modelKwargs??{},this.timeout=a?.timeout,this.temperature=a?.temperature??this.temperature,this.topP=a?.topP??this.topP,this.frequencyPenalty=a?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=a?.presencePenalty??this.presencePenalty,this.maxTokens=a?.maxTokens,this.n=a?.n??this.n,this.logitBias=a?.logitBias,this.stop=a?.stop,this.streaming=a?.streaming??!1,this.streaming&&this.n>1)throw new Error("Cannot stream results when n > 1");this.clientConfig={apiKey:s,...i}}invocationParams(){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens,n:this.n,logit_bias:this.logitBias,stop:this.stop,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}_generate(a,i){var s=this;return(0,c.Z)(function*(){const u={};if(s.stop&&i)throw new Error("Stop found in input and default params");const l=s.invocationParams();l.stop=i??l.stop;const j=a.map(P=>({role:Z(P._getType()),content:P.text,name:P.name})),A=l.stream?yield new Promise((P,L)=>{let T,K=!1;s.completionWithRetry({...l,messages:j},{responseType:"stream",onmessage:I=>{if("[DONE]"===I.data?.trim?.())P(T);else{const U=JSON.parse(I.data);T||(T={id:U.id,object:U.object,created:U.created,model:U.model,choices:[]});const e=U.choices[0];if(null!=e){let n=T.choices.find(t=>t.index===e.index);n||(n={index:e.index,finish_reason:e.finish_reason??void 0},T.choices.push(n)),n.message||(n.message={role:e.delta?.role,content:e.delta?.content??""}),n.message.content+=e.delta?.content??"",s.callbackManager.handleLLMNewToken(e.delta?.content??"",!0)}}}}).catch(I=>{K||(K=!0,L(I))})}):yield s.completionWithRetry({...l,messages:j}),{completion_tokens:m,prompt_tokens:N,total_tokens:B}=A.usage??{};m&&(u.completionTokens=(u.completionTokens??0)+m),N&&(u.promptTokens=(u.promptTokens??0)+N),B&&(u.totalTokens=(u.totalTokens??0)+B);const D=[];for(const P of A.choices){const T=P.message?.content??"";D.push({text:T,message:b(P.message?.role??void 0,T)})}return{generations:D,llmOutput:{tokenUsage:u}}})()}getNumTokensFromMessages(a){var i=this;return(0,c.Z)(function*(){let s=0,u=0,l=0;"gpt-3.5-turbo"===(0,v._i)(i.modelName)?(u=4,l=-1):(0,v._i)(i.modelName).startsWith("gpt-4")&&(u=3,l=1);const j=yield Promise.all(a.map(function(){var A=(0,c.Z)(function*(m){const B=(yield i.getNumTokens(m.text))+u+(m.name?l:0);return s+=B,B});return function(m){return A.apply(this,arguments)}}()));return{totalCount:s,countPerMessage:j}})()}completionWithRetry(a,i){var s=this;return(0,c.Z)(function*(){if(!s.client){const u=new O.Configuration({...s.clientConfig,baseOptions:{timeout:s.timeout,adapter:M.Z,...s.clientConfig.baseOptions}});s.client=new O.OpenAIApi(u)}return s.caller.call(s.client.createChatCompletion.bind(s.client),a,i).then(u=>u.data)})()}_llmType(){return"openai"}_combineLLMOutput(...a){return a.reduce((i,s)=>(s&&s.tokenUsage&&(i.tokenUsage.completionTokens+=s.tokenUsage.completionTokens??0,i.tokenUsage.promptTokens+=s.tokenUsage.promptTokens??0,i.tokenUsage.totalTokens+=s.tokenUsage.totalTokens??0),i),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}},28256:(z,S,d)=>{d.d(S,{d9:()=>O,fF:()=>c,zs:()=>M});class c{}const O=(f,k)=>{if(void 0!==k)return f[k];const x=Object.keys(f);if(1===x.length)return f[x[0]];throw new Error(`input values have multiple keys, memory only supported when one key currently: ${x}`)};function M(f,k="Human",x="AI"){const R=[];for(const C of f){let v;if("human"===C._getType())v=k;else if("ai"===C._getType())v=x;else if("system"===C._getType())v="System";else{if("generic"!==C._getType())throw new Error(`Got unsupported message type: ${C}`);v=C.role}R.push(`${v}: ${C.text}`)}return R.join("\n")}},74010:(z,S,d)=>{d.d(S,{Ck:()=>M,J:()=>k,K3:()=>Z,MJ:()=>x,Z:()=>O,w:()=>f});class c{constructor(E){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=E}}class O extends c{_getType(){return"human"}}class M extends c{_getType(){return"ai"}}class f extends c{_getType(){return"system"}}class k extends c{constructor(E,y){super(E),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=y}_getType(){return"generic"}}class x{}class v extends Error{constructor(E){super(E)}}class Z{}},70052:(z,S,d)=>{d.d(S,{Z:()=>D});var c=d(15861),O=d(63014);const M="text/event-stream";function k(){return(k=(0,c.Z)(function*(e,n){const t=e.getReader();let r;for(;!(r=yield t.read()).done;)n(r.value)})).apply(this,arguments)}function y(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function A(e){return Array.isArray(e)}function m(e,n){if(!(null===e||typeof e>"u"))if("object"!=typeof e&&(e=[e]),A(e))for(var t=0,r=e.length;t<r;t++)n.call(null,e[t],t,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.call(null,e[o],o,e)}function D(e){return P.apply(this,arguments)}function P(){return P=(0,c.Z)(function*(e){const n=function K(e){const n=new Headers(e.headers);if(e.auth){const _=e.auth.username||"",p=e.auth.password?decodeURI(encodeURIComponent(e.auth.password)):"";n.set("Authorization",`Basic ${btoa(`${_}:${p}`)}`)}const t=e.method.toUpperCase(),r={headers:n,method:t};"GET"!==t&&"HEAD"!==t&&(r.body=e.data,function N(e){return"[object FormData]"===toString.call(e)}(r.body)&&function B(){return(!(typeof navigator<"u")||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&typeof window<"u"&&typeof document<"u"}()&&n.delete("Content-Type")),e.mode&&(r.mode=e.mode),e.cache&&(r.cache=e.cache),e.integrity&&(r.integrity=e.integrity),e.redirect&&(r.redirect=e.redirect),e.referrer&&(r.referrer=e.referrer),e.timeout&&e.timeout>0&&(r.signal=AbortSignal.timeout(e.timeout)),e.signal&&(r.signal=e.signal),function s(e){return typeof e>"u"}(e.withCredentials)||(r.credentials=e.withCredentials?"include":"omit"),"stream"===e.responseType&&r.headers.set("Accept",M);const o=function i(e,n){return e&&!function b(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(n)?function E(e,n){return n?e.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):e}(e,n):n}(e.baseURL,e.url),h=function a(e,n,t){if(!n)return e;var r;if(t)r=t(n);else if(function j(e){return"[object URLSearchParams]"===toString.call(e)}(n))r=n.toString();else{var o=[];m(n,function(p,g){null===p||typeof p>"u"||(A(p)?g=`${g}[]`:p=[p],m(p,function(w){!function l(e){return"[object Date]"===toString.call(e)}(w)?function u(e){return null!==e&&"object"==typeof e}(w)&&(w=JSON.stringify(w)):w=w.toISOString(),o.push(`${y(g)}=${y(w)}`)}))}),r=o.join("&")}if(r){var h=e.indexOf("#");-1!==h&&(e=e.slice(0,h)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}(o,e.params,e.paramsSerializer);return new Request(h,r)}(e),t=yield function L(e,n){return T.apply(this,arguments)}(n,e);return new Promise((r,o)=>{t instanceof Error?o(t):"[object Function]"===Object.prototype.toString.call(e.settle)?e.settle(r,o,t):function Z(e,n,t){const{validateStatus:r}=t.config;t.status&&r&&!r(t.status)?n(I(`Request failed with status code ${t.status}`,t.config,null,t.request,t)):e(t)}(r,o,t)})}),P.apply(this,arguments)}function T(){return T=(0,c.Z)(function*(e,n){let t;try{t=yield fetch(e)}catch{return I("Network Error",n,"ERR_NETWORK",e)}const r={};t.headers.forEach((h,_)=>{r[_]=h});const o={ok:t.ok,status:t.status,statusText:t.statusText,headers:r,config:n,request:e};if(t.status>=200&&204!==t.status)if("stream"===n.responseType){const h=t.headers.get("content-type");if(!h?.startsWith(M))throw new Error(`Expected content-type to be ${M}, Actual: ${h}`);yield function f(e,n){return k.apply(this,arguments)}(t.body,function x(e){let n,t,r,o=!1;return function(_){void 0===n?(n=_,t=0,r=-1):n=function C(e,n){const t=new Uint8Array(e.length+n.length);return t.set(e),t.set(n,e.length),t}(n,_);const p=n.length;let g=0;for(;t<p;){o&&(10===n[t]&&(g=++t),o=!1);let $=-1;for(;t<p&&-1===$;++t)switch(n[t]){case 58:-1===r&&(r=t-g);break;case 13:o=!0;case 10:$=t}if(-1===$)break;e(n.subarray(g,$),r),g=t,r=-1}g===p?n=void 0:0!==g&&(n=n.subarray(g),t-=g)}}(function R(e,n,t){let r={data:"",event:"",id:"",retry:void 0};const o=new TextDecoder;return function(_,p){if(0===_.length)e?.(r),r={data:"",event:"",id:"",retry:void 0};else if(p>0){const g=o.decode(_.subarray(0,p)),w=o.decode(_.subarray(p+(32===_[p+1]?2:1)));switch(g){case"data":r.data=r.data?r.data+"\n"+w:w;break;case"event":r.event=w;break;case"id":n?.(r.id=w);break;case"retry":{const J=parseInt(w,10);Number.isNaN(J)||t?.(r.retry=J);break}}}}}(n.onmessage)))}else switch(n.responseType){case"arraybuffer":o.data=yield t.arrayBuffer();break;case"blob":o.data=yield t.blob();break;case"json":o.data=yield t.json();break;case"formData":o.data=yield t.formData();break;default:o.data=yield t.text()}return o}),T.apply(this,arguments)}function I(e,n,t,r,o){return O.AxiosError&&"function"==typeof O.AxiosError?new O.AxiosError(e,O.AxiosError[t],n,r,o):function U(e,n,t,r,o){return e.config=n,t&&(e.code=t),e.request=r,e.response=o,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}(new Error(e),n,t,r,o)}}}]);