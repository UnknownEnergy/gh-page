"use strict";(self.webpackChunkchatgpt_api=self.webpackChunkchatgpt_api||[]).push([[411],{64411:(U,N,v)=>{v.r(N),v.d(N,{OpenAI:()=>R,OpenAIChat:()=>I,PromptLayerOpenAI:()=>z});var f=v(15861),k=v(10157),C=v(70052);const S=(x,t)=>x.reduce((s,r,o)=>{const l=Math.floor(o/t);return s[l]=(s[l]||[]).concat([r]),s},[]);var E=v(49870);const A=(...x)=>E(x.join("_"));class K{}const Z=new Map;class j extends K{constructor(t){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=t??new Map}lookup(t,s){return Promise.resolve(this.cache.get(A(t,s))??null)}update(t,s,r){var o=this;return(0,f.Z)(function*(){o.cache.set(A(t,s),r)})()}static global(){return new j(Z)}}var B=v(88121);class M extends B.q{constructor({cache:t,concurrency:s,...r}){super(s?{maxConcurrency:s,...r}:r),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache="object"==typeof t?t:t?j.global():void 0}generatePrompt(t,s){var r=this;return(0,f.Z)(function*(){const o=t.map(l=>l.toString());return r.generate(o,s)})()}_generateUncached(t,s){var r=this;return(0,f.Z)(function*(){let o;yield r.callbackManager.handleLLMStart({name:r._llmType()},t,r.verbose);try{o=yield r._generate(t,s)}catch(l){throw yield r.callbackManager.handleLLMError(l,r.verbose),l}return yield r.callbackManager.handleLLMEnd(o,r.verbose),o})()}generate(t,s){var r=this;return(0,f.Z)(function*(){if(!Array.isArray(t))throw new Error("Argument 'prompts' is expected to be a string[]");if(!r.cache)return r._generateUncached(t,s);const{cache:o}=r,l=r.serialize();l.stop=s;const c=`${Object.entries(l).sort()}`,p=[],_=yield Promise.all(t.map(function(){var b=(0,f.Z)(function*(y,d){const e=yield o.lookup(y,c);return e||p.push(d),e});return function(y,d){return b.apply(this,arguments)}}()));let P={};if(p.length>0){const b=yield r._generateUncached(p.map(y=>t[y]),s);yield Promise.all(b.generations.map(function(){var y=(0,f.Z)(function*(d,e){const i=p[e];return _[i]=d,o.update(t[i],c,d)});return function(d,e){return y.apply(this,arguments)}}())),P=b.llmOutput??{}}return{generations:_,llmOutput:P}})()}call(t,s){var r=this;return(0,f.Z)(function*(){const{generations:o}=yield r.generate([t],s);return o[0][0].text})()}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}_modelType(){return"base_llm"}static deserialize(t){return(0,f.Z)(function*(){const{_type:s,_model:r,...o}=t;if(r&&"base_llm"!==r)throw new Error(`Cannot load LLM with model ${r}`);const l={openai:(yield Promise.resolve().then(v.bind(v,64411))).OpenAI}[s];if(void 0===l)throw new Error(`Cannot load  LLM with type ${s}`);return new l(o)})()}}class L extends M{_generate(t,s){var r=this;return(0,f.Z)(function*(){const o=[];for(let l=0;l<t.length;l+=1){const c=yield r._call(t[l],s);o.push([{text:c}])}return{generations:o}})()}}var $=v(10394);class I extends L{constructor(t,s){super(t??{}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"prefixMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const r=t?.openAIApiKey??(typeof process<"u"?process.env.OPENAI_API_KEY:void 0);if(!r)throw new Error("OpenAI API key not found");if(this.modelName=t?.modelName??this.modelName,this.prefixMessages=t?.prefixMessages??this.prefixMessages,this.modelKwargs=t?.modelKwargs??{},this.timeout=t?.timeout,this.temperature=t?.temperature??this.temperature,this.topP=t?.topP??this.topP,this.frequencyPenalty=t?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=t?.presencePenalty??this.presencePenalty,this.n=t?.n??this.n,this.logitBias=t?.logitBias,this.maxTokens=t?.maxTokens,this.stop=t?.stop,this.streaming=t?.streaming??!1,this.streaming&&this.n>1)throw new Error("Cannot stream results when n > 1");this.clientConfig={apiKey:r,...s}}invocationParams(){return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,n:this.n,logit_bias:this.logitBias,max_tokens:this.maxTokens,stop:this.stop,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}formatMessages(t){const s={role:"user",content:t};return this.prefixMessages?[...this.prefixMessages,s]:[s]}_call(t,s){var r=this;return(0,f.Z)(function*(){if(r.stop&&s)throw new Error("Stop found in input and default params");const o=r.invocationParams();return o.stop=s??o.stop,(o.stream?yield new Promise((c,p)=>{let _,P=!1;r.completionWithRetry({...o,messages:r.formatMessages(t)},{responseType:"stream",onmessage:b=>{if("[DONE]"===b.data?.trim?.())c(_);else{const y=JSON.parse(b.data);_||(_={id:y.id,object:y.object,created:y.created,model:y.model,choices:[]});const d=y.choices[0];if(null!=d){let e=_.choices.find(i=>i.index===d.index);e||(e={index:d.index,finish_reason:d.finish_reason??void 0},_.choices.push(e)),e.message||(e.message={role:d.delta?.role,content:d.delta?.content??""}),e.message.content+=d.delta?.content??"",r.callbackManager.handleLLMNewToken(d.delta?.content??"",!0)}}}}).catch(b=>{P||(P=!0,p(b))})}):yield r.completionWithRetry({...o,messages:r.formatMessages(t)})).choices[0].message?.content??""})()}completionWithRetry(t,s){var r=this;return(0,f.Z)(function*(){if(!r.client){const o=new k.Configuration({...r.clientConfig,baseOptions:{timeout:r.timeout,adapter:C.Z,...r.clientConfig.baseOptions}});r.client=new k.OpenAIApi(o)}return r.caller.call(r.client.createChatCompletion.bind(r.client),t,s).then(o=>o.data)})()}_llmType(){return"openai"}}class R extends M{constructor(t,s){if(t?.modelName?.startsWith("gpt-3.5-turbo")||t?.modelName?.startsWith("gpt-4"))return new I(t,s);super(t??{}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:.7}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:256}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"bestOf",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-davinci-003"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:20}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const r=t?.openAIApiKey??(typeof process<"u"?process.env.OPENAI_API_KEY:void 0);if(!r)throw new Error("OpenAI API key not found");if(this.modelName=t?.modelName??this.modelName,this.modelKwargs=t?.modelKwargs??{},this.batchSize=t?.batchSize??this.batchSize,this.timeout=t?.timeout,this.temperature=t?.temperature??this.temperature,this.maxTokens=t?.maxTokens??this.maxTokens,this.topP=t?.topP??this.topP,this.frequencyPenalty=t?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=t?.presencePenalty??this.presencePenalty,this.n=t?.n??this.n,this.bestOf=t?.bestOf??this.bestOf,this.logitBias=t?.logitBias,this.stop=t?.stop,this.streaming=t?.streaming??!1,this.streaming&&this.n>1)throw new Error("Cannot stream results when n > 1");if(this.streaming&&this.bestOf>1)throw new Error("Cannot stream results when bestOf > 1");this.clientConfig={apiKey:r,...s}}invocationParams(){return{model:this.modelName,temperature:this.temperature,max_tokens:this.maxTokens,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,n:this.n,best_of:this.bestOf,logit_bias:this.logitBias,stop:this.stop,stream:this.streaming,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}_generate(t,s){var r=this;return(0,f.Z)(function*(){const o=S(t,r.batchSize),l=[],c={};if(r.stop&&s)throw new Error("Stop found in input and default params");const p=r.invocationParams();if(p.stop=s??p.stop,-1===p.max_tokens){if(1!==t.length)throw new Error("max_tokens set to -1 not supported for multiple inputs");p.max_tokens=yield(0,$.F1)({prompt:t[0],modelName:r.modelName})}for(let P=0;P<o.length;P+=1){const b=p.stream?yield new Promise((i,n)=>{const a={};let u,g=!1;r.completionWithRetry({...p,prompt:o[P]},{responseType:"stream",onmessage:w=>{if("[DONE]"===w.data?.trim?.())i({...u,choices:[a]});else{const h=JSON.parse(w.data);u||(u={id:h.id,object:h.object,created:h.created,model:h.model});const m=h.choices[0];null!=m&&(a.text=(a.text??"")+(m.text??""),a.finish_reason=m.finish_reason,a.logprobs=m.logprobs,r.callbackManager.handleLLMNewToken(m.text??"",!0))}}}).catch(w=>{g||(g=!0,n(w))})}):yield r.completionWithRetry({...p,prompt:o[P]});l.push(...b.choices);const{completion_tokens:y,prompt_tokens:d,total_tokens:e}=b.usage??{};y&&(c.completionTokens=(c.completionTokens??0)+y),d&&(c.promptTokens=(c.promptTokens??0)+d),e&&(c.totalTokens=(c.totalTokens??0)+e)}return{generations:S(l,r.n).map(P=>P.map(b=>({text:b.text??"",generationInfo:{finishReason:b.finish_reason,logprobs:b.logprobs}}))),llmOutput:{tokenUsage:c}}})()}completionWithRetry(t,s){var r=this;return(0,f.Z)(function*(){if(!r.client){const o=new k.Configuration({...r.clientConfig,baseOptions:{timeout:r.timeout,adapter:C.Z,...r.clientConfig.baseOptions}});r.client=new k.OpenAIApi(o)}return r.caller.call(r.client.createCompletion.bind(r.client),t,s).then(o=>o.data)})()}_llmType(){return"openai"}}class z extends R{constructor(t){if(super(t),Object.defineProperty(this,"promptLayerApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"plTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.plTags=t?.plTags??[],this.promptLayerApiKey=t?.promptLayerApiKey??(typeof process<"u"?process.env.PROMPTLAYER_API_KEY:void 0),!this.promptLayerApiKey)throw new Error("Missing PromptLayer API key")}completionWithRetry(t,s){var r=()=>super.completionWithRetry,o=this;return(0,f.Z)(function*(){if(t.stream)return r().call(o,t,s);const l=Date.now(),c=yield r().call(o,t),p=Date.now();return yield o.caller.call(fetch,"https://api.promptlayer.com/track-request",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({function_name:"openai.Completion.create",args:[],kwargs:{engine:t.model,prompt:t.prompt},tags:o.plTags??[],request_response:c,request_start_time:Math.floor(l/1e3),request_end_time:Math.floor(p/1e3),api_key:o.promptLayerApiKey})}),c})()}}},70052:(U,N,v)=>{v.d(N,{Z:()=>c});var f=v(15861),k=v(63014);const C="text/event-stream";function E(){return(E=(0,f.Z)(function*(e,i){const n=e.getReader();let a;for(;!(a=yield n.read()).done;)i(a.value)})).apply(this,arguments)}function L(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function s(e){return Array.isArray(e)}function r(e,i){if(!(null===e||typeof e>"u"))if("object"!=typeof e&&(e=[e]),s(e))for(var n=0,a=e.length;n<a;n++)i.call(null,e[n],n,e);else for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&i.call(null,e[u],u,e)}function c(e){return p.apply(this,arguments)}function p(){return p=(0,f.Z)(function*(e){const i=function b(e){const i=new Headers(e.headers);if(e.auth){const w=e.auth.username||"",h=e.auth.password?decodeURI(encodeURIComponent(e.auth.password)):"";i.set("Authorization",`Basic ${btoa(`${w}:${h}`)}`)}const n=e.method.toUpperCase(),a={headers:i,method:n};"GET"!==n&&"HEAD"!==n&&(a.body=e.data,function o(e){return"[object FormData]"===toString.call(e)}(a.body)&&function l(){return(!(typeof navigator<"u")||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&typeof window<"u"&&typeof document<"u"}()&&i.delete("Content-Type")),e.mode&&(a.mode=e.mode),e.cache&&(a.cache=e.cache),e.integrity&&(a.integrity=e.integrity),e.redirect&&(a.redirect=e.redirect),e.referrer&&(a.referrer=e.referrer),e.timeout&&e.timeout>0&&(a.signal=AbortSignal.timeout(e.timeout)),e.signal&&(a.signal=e.signal),function R(e){return typeof e>"u"}(e.withCredentials)||(a.credentials=e.withCredentials?"include":"omit"),"stream"===e.responseType&&a.headers.set("Accept",C);const u=function I(e,i){return e&&!function B(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(i)?function M(e,i){return i?e.replace(/\/+$/,"")+"/"+i.replace(/^\/+/,""):e}(e,i):i}(e.baseURL,e.url),g=function $(e,i,n){if(!i)return e;var a;if(n)a=n(i);else if(function t(e){return"[object URLSearchParams]"===toString.call(e)}(i))a=i.toString();else{var u=[];r(i,function(h,m){null===h||typeof h>"u"||(s(h)?m=`${m}[]`:h=[h],r(h,function(O){!function x(e){return"[object Date]"===toString.call(e)}(O)?function z(e){return null!==e&&"object"==typeof e}(O)&&(O=JSON.stringify(O)):O=O.toISOString(),u.push(`${L(m)}=${L(O)}`)}))}),a=u.join("&")}if(a){var g=e.indexOf("#");-1!==g&&(e=e.slice(0,g)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}(u,e.params,e.paramsSerializer);return new Request(g,a)}(e),n=yield function _(e,i){return P.apply(this,arguments)}(i,e);return new Promise((a,u)=>{n instanceof Error?u(n):"[object Function]"===Object.prototype.toString.call(e.settle)?e.settle(a,u,n):function D(e,i,n){const{validateStatus:a}=n.config;n.status&&a&&!a(n.status)?i(y(`Request failed with status code ${n.status}`,n.config,null,n.request,n)):e(n)}(a,u,n)})}),p.apply(this,arguments)}function P(){return P=(0,f.Z)(function*(e,i){let n;try{n=yield fetch(e)}catch{return y("Network Error",i,"ERR_NETWORK",e)}const a={};n.headers.forEach((g,w)=>{a[w]=g});const u={ok:n.ok,status:n.status,statusText:n.statusText,headers:a,config:i,request:e};if(n.status>=200&&204!==n.status)if("stream"===i.responseType){const g=n.headers.get("content-type");if(!g?.startsWith(C))throw new Error(`Expected content-type to be ${C}, Actual: ${g}`);yield function S(e,i){return E.apply(this,arguments)}(n.body,function A(e){let i,n,a,u=!1;return function(w){void 0===i?(i=w,n=0,a=-1):i=function Z(e,i){const n=new Uint8Array(e.length+i.length);return n.set(e),n.set(i,e.length),n}(i,w);const h=i.length;let m=0;for(;n<h;){u&&(10===i[n]&&(m=++n),u=!1);let T=-1;for(;n<h&&-1===T;++n)switch(i[n]){case 58:-1===a&&(a=n-m);break;case 13:u=!0;case 10:T=n}if(-1===T)break;e(i.subarray(m,T),a),m=n,a=-1}m===h?i=void 0:0!==m&&(i=i.subarray(m),n-=m)}}(function K(e,i,n){let a={data:"",event:"",id:"",retry:void 0};const u=new TextDecoder;return function(w,h){if(0===w.length)e?.(a),a={data:"",event:"",id:"",retry:void 0};else if(h>0){const m=u.decode(w.subarray(0,h)),O=u.decode(w.subarray(h+(32===w[h+1]?2:1)));switch(m){case"data":a.data=a.data?a.data+"\n"+O:O;break;case"event":a.event=O;break;case"id":i?.(a.id=O);break;case"retry":{const W=parseInt(O,10);Number.isNaN(W)||n?.(a.retry=W);break}}}}}(i.onmessage)))}else switch(i.responseType){case"arraybuffer":u.data=yield n.arrayBuffer();break;case"blob":u.data=yield n.blob();break;case"json":u.data=yield n.json();break;case"formData":u.data=yield n.formData();break;default:u.data=yield n.text()}return u}),P.apply(this,arguments)}function y(e,i,n,a,u){return k.AxiosError&&"function"==typeof k.AxiosError?new k.AxiosError(e,k.AxiosError[n],i,a,u):function d(e,i,n,a,u){return e.config=i,n&&(e.code=n),e.request=a,e.response=u,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}(new Error(e),i,n,a,u)}}}]);